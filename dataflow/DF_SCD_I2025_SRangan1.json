{
	"name": "DF_SCD_I2025_SRangan1",
	"properties": {
		"folder": {
			"name": "TDSG Day 5 Training"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "DS_Blob",
						"type": "DatasetReference"
					},
					"name": "source"
				},
				{
					"dataset": {
						"referenceName": "DS_Source_I2025_SRangan1",
						"type": "DatasetReference"
					},
					"name": "target"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "DS_Source_I2025_SRangan1",
						"type": "DatasetReference"
					},
					"name": "sink1"
				}
			],
			"transformations": [
				{
					"name": "nullhandling"
				},
				{
					"name": "join1"
				},
				{
					"name": "split1"
				},
				{
					"name": "select1"
				},
				{
					"name": "select2"
				},
				{
					"name": "dtypehandling"
				},
				{
					"name": "dtypetarget"
				},
				{
					"name": "select3"
				},
				{
					"name": "alterRow1"
				},
				{
					"name": "union1"
				},
				{
					"name": "derivedColumn1"
				},
				{
					"name": "split2"
				},
				{
					"name": "select4"
				},
				{
					"name": "union2"
				},
				{
					"name": "derivedColumn2"
				}
			],
			"scriptLines": [
				"source(output(",
				"          EmployeeID as string,",
				"          Name as string,",
				"          Gender as string,",
				"          DateOfBirth as string,",
				"          Department as string,",
				"          JobTitle as string,",
				"          Salary as integer,",
				"          HireDate as string,",
				"          Address as string,",
				"          Email as string,",
				"          PhoneNumber as string,",
				"          MaritalStatus as string,",
				"          EffectiveDate as string,",
				"          EndDate as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> source",
				"source(output(",
				"          EmployeeID as short,",
				"          Name as string,",
				"          DateOfBirth as date,",
				"          Department as string,",
				"          JobTitle as string,",
				"          Salary as integer,",
				"          HireDate as date,",
				"          Address as string,",
				"          Email as string,",
				"          PhoneNumber as string,",
				"          MaritalStatus as string,",
				"          EffectiveDate as date,",
				"          EndDate as string,",
				"          surr_key as short,",
				"          createBy as string,",
				"          time as date",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> target",
				"dtypehandling derive(each(match(type=='string'), $$ = iifNull($$, 'UNK')),",
				"          each(match(type=='Integer'), $$ = iifNull($#, -1)),",
				"          each(match(type=='float'), $$ = iifNull($#, 0))) ~> nullhandling",
				"nullhandling, select3 join(EmployeeID == {t.EmployeeID},",
				"     joinType:'left',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> join1",
				"join1 split(isNull({t.EmployeeID}),",
				"     disjoint: false) ~> split1@(insert, update)",
				"derivedColumn1 select(mapColumn(",
				"          EmployeeID,",
				"          Name,",
				"          Gender,",
				"          DateOfBirth,",
				"          Department,",
				"          JobTitle,",
				"          Salary,",
				"          HireDate,",
				"          Address,",
				"          Email,",
				"          PhoneNumber,",
				"          MaritalStatus,",
				"          EffectiveDate,",
				"          EndDate,",
				"          createBy,",
				"          time",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select1",
				"alterRow1 select(mapColumn(",
				"          EmployeeID,",
				"          JobTitle,",
				"          Salary,",
				"          EmployeeID = {t.EmployeeID},",
				"          Name = {t.Name},",
				"          DateOfBirth = {t.DateOfBirth},",
				"          Department = {t.Department},",
				"          HireDate = {t.HireDate},",
				"          Address = {t.Address},",
				"          Email = {t.Email},",
				"          PhoneNumber = {t.PhoneNumber},",
				"          MaritalStatus = {t.MaritalStatus},",
				"          EffectiveDate = {t.EffectiveDate},",
				"          EndDate = {t.EndDate},",
				"          surr_key = {t.surr_key},",
				"          createBy = {t.createBy},",
				"          time = {t.time},",
				"          modifiedby = {t.modifiedby},",
				"          modified_date = {t.modified_date}",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select2",
				"source derive(EmployeeID = toInteger(EmployeeID),",
				"          DateOfBirth = toDate(DateOfBirth, 'dd-MM-yyyy'),",
				"          HireDate = toDate(HireDate, 'dd-MM-yyyy'),",
				"          EndDate = toDate(EndDate, 'dd-MM-yyyy'),",
				"          EffectiveDate = toDate(EffectiveDate, 'dd-MM-yyyy')) ~> dtypehandling",
				"target derive(EmployeeID = toInteger(EmployeeID),",
				"          EndDate = toDate(EndDate, 'dd-MM-yyyy')) ~> dtypetarget",
				"dtypetarget select(mapColumn(",
				"          {t.EmployeeID} = EmployeeID,",
				"          {t.Name} = Name,",
				"          {t.DateOfBirth} = DateOfBirth,",
				"          {t.Department} = Department,",
				"          {t.JobTitle} = JobTitle,",
				"          {t.Salary} = Salary,",
				"          {t.HireDate} = HireDate,",
				"          {t.Address} = Address,",
				"          {t.Email} = Email,",
				"          {t.PhoneNumber} = PhoneNumber,",
				"          {t.MaritalStatus} = MaritalStatus,",
				"          {t.EffectiveDate} = EffectiveDate,",
				"          {t.EndDate} = EndDate,",
				"          {t.surr_key} = surr_key,",
				"          {t.createBy} = createBy,",
				"          {t.time} = time",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select3",
				"split2@updating alterRow(updateIf(EmployeeID=={t.EmployeeID}&&(JobTitle!={t.JobTitle}||Salary!={t.Salary}))) ~> alterRow1",
				"derivedColumn2, select1 union(byName: true)~> union1",
				"split1@insert derive(createBy = 'I2025_SRangan1',",
				"          time = currentDate()) ~> derivedColumn1",
				"split1@update split(EmployeeID=={t.EmployeeID}&&(JobTitle!={t.JobTitle}||Salary!={t.Salary}),",
				"     disjoint: false) ~> split2@(updating, existing)",
				"split2@existing select(mapColumn(",
				"          {t.EmployeeID},",
				"          {t.Name},",
				"          {t.DateOfBirth},",
				"          {t.Department},",
				"          {t.JobTitle},",
				"          {t.Salary},",
				"          {t.HireDate},",
				"          {t.Address},",
				"          {t.Email},",
				"          {t.PhoneNumber},",
				"          {t.MaritalStatus},",
				"          {t.EffectiveDate},",
				"          {t.EndDate},",
				"          {t.surr_key},",
				"          {t.createBy},",
				"          {t.time},",
				"          {t.modifiedby},",
				"          {t.modified_date}",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select4",
				"union1, select4 union(byName: true)~> union2",
				"select2 derive(modified_by = 'I2025_SRangan1',",
				"          modified_date = currentTimestamp()) ~> derivedColumn2",
				"union2 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          ProductID as string,",
				"          Name as string,",
				"          ProductNumber as string,",
				"          MakeFlag as string,",
				"          FinishedGoodsFlag as string,",
				"          Color as string,",
				"          SafetyStockLevel as string,",
				"          ReorderPoint as string,",
				"          StandardCost as string,",
				"          ListPrice as string,",
				"          Size as string,",
				"          SizeUnitMeasureCode as string,",
				"          WeightUnitMeasureCode as string,",
				"          Weight as string,",
				"          DaysToManufacture as string,",
				"          ProductLine as string,",
				"          Class as string,",
				"          Style as string,",
				"          ProductSubcategoryID as string,",
				"          ProductModelID as string,",
				"          SellStartDate as string,",
				"          SellEndDate as string,",
				"          DiscontinuedDate as string,",
				"          rowguid as string,",
				"          ModifiedDate as string",
				"     ),",
				"     partitionFileNames:['employee_target.csv'],",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     partitionBy('hash', 1)) ~> sink1"
			]
		}
	}
}