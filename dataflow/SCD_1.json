{
	"name": "SCD_1",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "DS_Blob",
						"type": "DatasetReference"
					},
					"name": "source"
				},
				{
					"dataset": {
						"referenceName": "Intern_2025_csv_files",
						"type": "DatasetReference"
					},
					"name": "target"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "DS_csv_I2025_PArul",
						"type": "DatasetReference"
					},
					"name": "sink1"
				},
				{
					"dataset": {
						"referenceName": "DS_csv_I2025_PArul",
						"type": "DatasetReference"
					},
					"name": "sink2"
				}
			],
			"transformations": [
				{
					"name": "join"
				},
				{
					"name": "alterRow1"
				},
				{
					"name": "alterRow2"
				},
				{
					"name": "surrogateKey1"
				}
			],
			"scriptLines": [
				"source(output(",
				"          employee_id as integer,",
				"          first_name as string,",
				"          last_name as string,",
				"          email as string,",
				"          phone_number as string,",
				"          hire_date as timestamp,",
				"          job_id as string,",
				"          salary as integer,",
				"          commission_pct as integer,",
				"          manager_id as integer,",
				"          department_id as integer",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> source",
				"source(output(",
				"          employee_id as integer,",
				"          first_name as string,",
				"          last_name as string,",
				"          email as string,",
				"          phone_number as string,",
				"          hire_date as string,",
				"          job_id as string,",
				"          salary as integer,",
				"          commission_pct as integer,",
				"          manager_id as integer,",
				"          department as integer",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> target",
				"surrogateKey1, target join(source@employee_id == target@employee_id,",
				"     joinType:'left',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> join",
				"join alterRow(updateIf(source@employee_id==target@employee_id&&source@salary!=target@salary)) ~> alterRow1",
				"join alterRow(insertIf(source@employee_id!=target@employee_id)) ~> alterRow2",
				"source keyGenerate(output(surrogate_id as long),",
				"     startAt: 1L,",
				"     stepValue: 1L) ~> surrogateKey1",
				"alterRow2 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     mapColumn(",
				"          employee_id = surrogate_id,",
				"          first_name = source@first_name,",
				"          last_name = source@last_name,",
				"          email = source@email,",
				"          phone_number = source@phone_number,",
				"          hire_date = source@hire_date,",
				"          job_id = source@job_id,",
				"          salary = source@salary,",
				"          commission_pct = source@commission_pct,",
				"          manager_id = source@manager_id,",
				"          department_id,",
				"          surrogate_id,",
				"          employee_id = target@employee_id,",
				"          first_name = target@first_name,",
				"          last_name = target@last_name,",
				"          email = target@email,",
				"          phone_number = target@phone_number,",
				"          hire_date = target@hire_date,",
				"          job_id = target@job_id,",
				"          salary = target@salary,",
				"          commission_pct = target@commission_pct,",
				"          manager_id = target@manager_id,",
				"          department",
				"     )) ~> sink1",
				"alterRow1 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     mapColumn(",
				"          employee_id = surrogate_id,",
				"          first_name = source@first_name,",
				"          last_name = source@last_name,",
				"          email = source@email,",
				"          phone_number = source@phone_number,",
				"          hire_date = source@hire_date,",
				"          job_id = source@job_id,",
				"          salary = source@salary,",
				"          commission_pct = source@commission_pct,",
				"          manager_id = source@manager_id,",
				"          department_id,",
				"          surrogate_id,",
				"          employee_id = target@employee_id,",
				"          first_name = target@first_name,",
				"          last_name = target@last_name,",
				"          email = target@email,",
				"          phone_number = target@phone_number,",
				"          hire_date = target@hire_date,",
				"          job_id = target@job_id,",
				"          salary = target@salary,",
				"          commission_pct = target@commission_pct,",
				"          manager_id = target@manager_id,",
				"          department",
				"     )) ~> sink2"
			]
		}
	}
}